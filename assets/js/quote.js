document.addEventListener('DOMContentLoaded',function(){const printType=document.getElementById('printType');const bookOrderFields=document.getElementById('bookOrderFields');const bookOrderBindingFields=document.getElementById('bookOrderBindingFields');const formSteps=document.querySelectorAll('.form-step');const progressSteps=document.querySelectorAll('.progress-step');const nextButtons=document.querySelectorAll('.next-step');const prevButtons=document.querySelectorAll('.prev-step');const form=document.getElementById('quoteForm');const successMessage=document.getElementById('successMessage');const reviewContent=document.getElementById('reviewContent');printType.addEventListener('change',function(){bookOrderFields.classList.remove('active');bookOrderBindingFields.classList.remove('active');if(this.value==='book order'){bookOrderFields.classList.add('active')}else if(this.value==='book order+binding'||this.value==='hard binding'){bookOrderBindingFields.classList.add('active')}});nextButtons.forEach(button=>{button.addEventListener('click',function(){const currentStep=document.querySelector('.form-step.active');const nextStepId=this.getAttribute('data-next');const nextStep=document.getElementById(`step${nextStepId}`);if(validateStep(currentStep.id)){updateProgressIndicator(nextStepId);currentStep.classList.remove('active');nextStep.classList.add('active');document.getElementById('quoteForm').scrollIntoView({behavior:'smooth',block:'start'});if(nextStepId==='3'){populateReview()}}})});prevButtons.forEach(button=>{button.addEventListener('click',function(){const currentStep=document.querySelector('.form-step.active');const prevStepId=this.getAttribute('data-prev');const prevStep=document.getElementById(`step${prevStepId}`);updateProgressIndicator(prevStepId,!1);currentStep.classList.remove('active');prevStep.classList.add('active');document.getElementById('quoteForm').scrollIntoView({behavior:'smooth',block:'start'})})});function updateProgressIndicator(stepId,isForward=!0){progressSteps.forEach(step=>{const stepNumber=step.getAttribute('data-step');if(stepNumber===stepId){step.classList.add('active')}else if(isForward&&parseInt(stepNumber)>parseInt(stepId)){step.classList.remove('active')}})}
function validateStep(stepId){const step=document.getElementById(stepId);const inputs=step.querySelectorAll('input[required], select[required], textarea[required]');let isValid=!0;inputs.forEach(input=>{const value=input.value.trim();input.classList.remove('is-invalid');if(!value){input.classList.add('is-invalid');isValid=!1;return}
if(input.type==='email'){const emailRegex=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!emailRegex.test(value)){input.classList.add('is-invalid');isValid=!1}}else if(input.type==='tel'){const phoneRegex=/^[0-9+\-()\s]{7,20}$/;if(!phoneRegex.test(value)){input.classList.add('is-invalid');isValid=!1}}else if(input.type==='number'){if(isNaN(value)||parseInt(value)<=0){input.classList.add('is-invalid');isValid=!1}}else if(input.id==='message'){if(value.length>500){input.classList.add('is-invalid');isValid=!1}}});if(printType.value==='book order+binding'||printType.value==='hard binding'){const bindingType=document.getElementById('bindingType');if(!bindingType.value){bindingType.classList.add('is-invalid');isValid=!1}else{bindingType.classList.remove('is-invalid')}}
return isValid}
function populateReview(){const formData=new FormData(form);let reviewHTML='<div class="row">';reviewHTML+='<div class="col-md-6">';reviewHTML+='<p><strong>Print Type:</strong> '+(printType.options[printType.selectedIndex].text||'Not specified')+'</p>';if(printType.value==='book order'){const pageSizing=document.getElementById('pageSizing');const noOfPages=document.getElementById('noOfPages');reviewHTML+='<p><strong>Page Size:</strong> '+(pageSizing.options[pageSizing.selectedIndex].text||'Not specified')+'</p>';reviewHTML+='<p><strong>Number of Pages:</strong> '+(noOfPages.value||'Not specified')+'</p>'}else if(printType.value==='book order+binding'||printType.value==='hard binding'){const pageSizingBinding=document.getElementById('pageSizingBinding');const noOfPagesBinding=document.getElementById('noOfPagesBinding');const bindingType=document.getElementById('bindingType');reviewHTML+='<p><strong>Page Size:</strong> '+(pageSizingBinding.options[pageSizingBinding.selectedIndex].text||'Not specified')+'</p>';reviewHTML+='<p><strong>Number of Pages:</strong> '+(noOfPagesBinding.value||'Not specified')+'</p>';reviewHTML+='<p><strong>Binding Type:</strong> '+(bindingType.options[bindingType.selectedIndex].text||'Not specified')+'</p>'}
reviewHTML+='<p><strong>Quantity:</strong> '+(document.getElementById('quantity').value||'Not specified')+'</p>';reviewHTML+='<p><strong>Purpose:</strong> '+(document.getElementById('purpose').options[document.getElementById('purpose').selectedIndex].text||'Not specified')+'</p>';reviewHTML+='</div>';reviewHTML+='<div class="col-md-6">';reviewHTML+='<p><strong>Name:</strong> '+(document.getElementById('name').value||'Not specified')+'</p>';reviewHTML+='<p><strong>Email:</strong> '+(document.getElementById('email').value||'Not specified')+'</p>';reviewHTML+='<p><strong>Phone:</strong> '+(document.getElementById('phone').value||'Not specified')+'</p>';reviewHTML+='<p><strong>Contact Method:</strong> '+(document.getElementById('contactMethod').options[document.getElementById('contactMethod').selectedIndex].text||'Not specified')+'</p>';reviewHTML+='</div>';const message=document.getElementById('message').value;if(message){reviewHTML+='<div class="col-12 mt-3">';reviewHTML+='<p><strong>Additional Details:</strong></p>';reviewHTML+='<p class="bg-white p-2 rounded">'+message+'</p>';reviewHTML+='</div>'}
reviewHTML+='</div>';reviewContent.innerHTML=reviewHTML}
form.addEventListener('submit',function(e){e.preventDefault();let allValid=!0;formSteps.forEach(step=>{if(!validateStep(step.id)){allValid=!1}});if(!allValid){alert('Please fix the errors in the form before submitting.');return}
const submitBtn=form.querySelector('button[type="submit"]');const originalBtnText=submitBtn.innerHTML;submitBtn.disabled=!0;submitBtn.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Sending...';const formData=new FormData(form);fetch('api/quote.php',{method:'POST',body:formData}).then(response=>response.json()).then(data=>{if(data.success){form.style.display='none';successMessage.style.display='block';successMessage.scrollIntoView({behavior:'smooth'});form.reset()}else{throw new Error(data.message||'Unknown error occurred')}}).catch(error=>{console.error('Error:',error);alert('Submission failed: '+error.message)}).finally(()=>{submitBtn.disabled=!1;submitBtn.innerHTML=originalBtnText})})})